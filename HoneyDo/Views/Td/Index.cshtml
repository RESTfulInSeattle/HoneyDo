@using System.Linq
@model IEnumerable<HoneyDo.Models.Todo>
    @Scripts.Render("~bundles/jqueryui")
    @Styles.Render("~/Content/themes/base/css")

@{
    ViewBag.Title = "Index";
    var grid = new WebGrid(source:Model,canPage:true,rowsPerPage:20);
    grid.Pager(WebGridPagerModes.All);
}

<h2>Index</h2>

<style type="text/css">
    
    .webgrid-table{
        font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
        font-size: 1.2em;
        width: 100%;
        display: table;
        border-collapse: separate;
        border: solid 1px #000000;
        background-color: white;
    }
    .webgrid-table td, th{
        border: 1px solid #000000;
        padding: 3px 7px 2px;
    }

    .webgrid-header{
        background-color: #b0c4de;
        color:  #000000;
        padding-bottom: 4px;
        padding-top: 5px;
        text-align: left;
    }

    popup-link {
        color: #000000;
    }
   
    .webgrid-row-style{
        padding: 3px 7px 2px;
    }
 

 </style>

<p>
    @Html.ActionLink("Create New", "Create")
</p>


<div id="content">
    @grid.GetHtml(
    tableStyle: "webgrid-table",
    headerStyle: "webgrid-header",
    footerStyle: "webgrid-footer",
    rowStyle: "webgrid-row-style",
    columns: grid.Columns(
        grid.Column(header: "Task Name", columnName: "TaskName"),
        grid.Column(header: "Due By", columnName: "Deadline"),
        grid.Column(header: "Completed", format:@<text><input type="checkbox" checked="@item.Completed" disabled="disabled" /></text>),
        grid.Column(header: "More Details", columnName: "Moredetails")
        ))
</div>


<script src="~/Scripts/jquery"></script>
<script>
    $(document).ready(function () {
        $("#content tbody tr").each(function (i, row) {
            var actualRow = (row);
            var taskDate = new Date(actualRow.findByName("Deadline").text);
            var todaysDate = new Date();
            if (taskDate < todaysDate ) {
                actualRow.css('background-color', '#ff4500');
            }
            else
            {
                actualRow.css('background-color', '#EAF2D3');
            }
        });
    });
</script>



@* ToDo make the below work with the controller so it can be unit tested

    <table class="table">
        <tr>

            <th>
                @Html.DisplayNameFor(model => model.TaskName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Deadline)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Completed)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Moredetails)
            </th>
            <th></th>
        </tr>

    @foreach (var item in Model) {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.TaskName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Deadline)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Completed)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Moredetails)
            </td>
            <td>
                @Html.ActionLink("Edit", "Edit", new { id=item.TodoId }) |
                @Html.ActionLink("Details", "Details", new { id=item.TodoId }) |
                @Html.ActionLink("Delete", "Delete", new { id=item.TodoId })
            </td>
        </tr>
    }

    </table>
*@